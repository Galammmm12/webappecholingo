<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ unit.title }} - EchoLingo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/unit_detail.css') }}" />
</head>
<body>
  <header>
    <div class="logo-container">
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="EchoLingo Logo" />
      <span class="logo-text"><span class="echo">Echo</span><span class="lingo">Lingo</span></span>
    </div>

    <!-- âœ… Navigation -->
    <div class="nav-center">
      <nav>
        <a href="{{ url_for('student.dashboard_en') }}">Home</a>
        <a href="{{ url_for('student.exercise_score_en') }}">Exercise Score</a>
        <a href="{{ url_for('student.test_scores_en') }}">Test Score</a>
      </nav>
    </div>

    <!-- âœ… Logout -->
    <div class="right-controls">
      <a href="{{ url_for('auth.logout') }}" class="btn-logout">Logout</a>
    </div>
  </header>

  <div class="container">
    <h2>
      {% if lang == "zh" %}
        ç¬¬{{ unit.id }}å•å…ƒ - {{ unit.title }}
        {% if unit.title_pinyin %}<br /><small>{{ unit.title_pinyin }}</small>{% endif %}
      {% else %}
        Unit {{ unit.id }} - {{ unit.title }}
      {% endif %}
    </h2>

    <!-- âœ… Test Section -->
    <div class="section">
      <div class="section-title">ğŸ“ Test</div>
      <div class="test-buttons">

        <!-- Pre-Test -->
        <div class="test-box">
          <h4>Pre-Test</h4>
          {% if pre_done %}
            <span class="status done">âœ… Done</span>
            <a class="start-btn" href="{{ url_for('student.test_scores_en') }}">Review</a>
          {% else %}
            <span class="status pending">ğŸ”´ Not Done</span>
<a class="start-btn" href="{{ url_for('quiz.student_take_quiz', lesson_id=unit.id, lang='en', test_type='pre') }}">Start</a>

          {% endif %}
        </div>

        <!-- Post-Test -->
        <div class="test-box">
          <h4>Post-Test</h4>
          {% if not pre_done %}
            <span class="status pending">ğŸ”’ Locked</span>
            <a class="start-btn disabled" title="Do Pre-Test first">Locked</a>
          {% else %}
            {% if post_done %}
              <span class="status done">âœ… Done</span>
              <a class="start-btn" href="{{ url_for('student.test_scores_en') }}">Review</a>
            {% else %}
              <span class="status pending">ğŸ”´ Not Done</span>
<a class="start-btn" href="{{ url_for('quiz.student_take_quiz', lesson_id=unit.id, lang='en', test_type='post') }}">Start</a>

            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>

    <!-- âœ… Games Section -->
    <div class="game-section">
      <div class="section-title">{{ "ç»ƒä¹ " if lang=="zh" else "Exercise" }}</div>
      {% if games %}
        <div class="games-grid">
          {% for game in games %}
            <div class="game-card">
              <div class="game-title">ğŸ² {{ game.title }}</div>
              <a href="{{ url_for('game.play_game', game_id=game.id) }}" class="play-btn">
                {{ "å¼€å§‹" if lang=="zh" else "Play" }}
              </a>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p style="text-align:center;color:#888;margin:10px 0 0;">
          {{ "æ­¤å•å…ƒè¿˜æ²¡æœ‰æ¸¸æˆã€‚" if lang=="zh" else "No games found for this unit." }}
        </p>
      {% endif %}
    </div>
  </div>
</body>
</html>
