<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>➕ เพิ่มคำถามใหม่</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Prompt', sans-serif;
      background: #f0faff;
      margin: 0;
      padding: 30px;
    }
    .wrap {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 25px 40px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #0052cc;
    }
    label {
      font-weight: 600;
      display: block;
      margin-top: 12px;
    }
    input[type=text], textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 4px;
      box-sizing: border-box;
      font-size: 1rem;
    }
    button {
      display: block;
      width: 100%;
      background: linear-gradient(135deg, #007bff, #00c2ff);
      border: none;
      padding: 12px;
      color: white;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      margin-top: 20px;
      cursor: pointer;
      transition: all 0.25s ease;
    }
    button:hover {
      background: linear-gradient(135deg, #005ec2, #00a3e0);
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>➕ เพิ่มคำถามใหม่</h2>
    <form method="POST" enctype="multipart/form-data">

      {% if lessons %}
        <!-- ✅ มีหลายบทให้เลือก -->
        <label>เลือกบทเรียน:</label>
        <select name="lesson_id" required>
          <option value="">-- เลือกบทเรียน --</option>
          {% for l in lessons %}
            <option value="{{ l.id }}" data-lang="{{ l.lang }}">{{ l.title }} ({{ l.lang|upper }})</option>
          {% endfor %}
        </select>
        <!-- ช่อง lang จะถูกอัปเดตอัตโนมัติด้วย JS -->
        <input type="hidden" name="lang" id="lang-input">
      {% else %}
        <!-- ✅ ถ้ามีเฉพาะ 1 บท (ส่งจาก URL) -->
        <input type="hidden" name="lesson_id" value="{{ lesson.id }}">
        <input type="hidden" name="lang" value="{{ lesson.lang }}">
        <p><b>บทเรียน:</b> {{ lesson.title }} ({{ lesson.lang|upper }})</p>
      {% endif %}

      <label>ประเภทคำถาม:</label>
      <select name="question_type" required>
        <option value="pre">Pre-Test</option>
        <option value="post">Post-Test</option>
        <option value="pre_zh">Pre-Test (จีน)</option>
        <option value="post_zh">Post-Test (จีน)</option>
      </select>

      <label>คำถาม:</label>
      <textarea name="question" required placeholder="พิมพ์คำถามที่นี่..."></textarea>

      <label>ตัวเลือก A:</label>
      <input type="text" name="option_a" required placeholder="ตัวเลือก A">

      <label>ตัวเลือก B:</label>
      <input type="text" name="option_b" required placeholder="ตัวเลือก B">

      <label>ตัวเลือก C:</label>
      <input type="text" name="option_c" required placeholder="ตัวเลือก C">

      <label>ตัวเลือก D:</label>
      <input type="text" name="option_d" required placeholder="ตัวเลือก D">

      <label>เลือกคำตอบที่ถูกต้อง:</label>
      <select name="correct_option" required>
        <option value="">-- เลือกคำตอบที่ถูกต้อง --</option>
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
      </select>

      <label>แนบรูปภาพ (ถ้ามี):</label>
      <input type="file" name="image">

      <button type="submit">✅ บันทึกคำถาม</button>
    </form>
  </div>

  <script>
    // ✅ auto fill hidden lang input เมื่อเลือกบทเรียน
    const selectLesson = document.querySelector("select[name='lesson_id']");
    const langInput = document.getElementById("lang-input");
    if (selectLesson && langInput) {
      selectLesson.addEventListener("change", function() {
        const lang = this.options[this.selectedIndex].getAttribute("data-lang");
        langInput.value = lang || "";
      });
    }
  </script>
</body>
</html>
